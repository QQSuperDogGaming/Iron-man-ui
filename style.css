:root{
  --cy:#00faff;
  --cy-rgb:0,250,255;
  --bg:#05070a;
  --glass:rgba(var(--cy-rgb),.08);
  --fit:1;
}

/* Smooth, direct theme transitions (no hue-rotate) */
:root, body, .core, .widget, .disc, .ring, .label,
.chip, .btn, .bar>div, .radar, .ctrl-fab, .help-card {
  transition:
    --cy .9s ease,
    --cy-rgb .9s ease,
    border-color .9s ease,
    background-color .9s ease,
    box-shadow .9s ease,
    filter .9s ease,
    text-shadow .9s ease,
    color .9s ease;
}

/* Reset */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:#fff;
  font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  overflow:hidden;
  font-size:clamp(12px,1.8vmin,16px);
}
body.nofx *{ transition:none !important; animation-play-state:paused !important; }

/* Background layers */
#stars,.grid,.scan{position:fixed; inset:0}
#stars{z-index:0; display:block}

/* ✅ Fixed grid: perfect squares instead of stretched rectangles */
.grid{
  z-index:0; pointer-events:none;
  background:
    linear-gradient(to right, rgba(var(--cy-rgb),.28) 1px, transparent 1px) 0 0/200px 200px,
    linear-gradient(to bottom, rgba(var(--cy-rgb),.28) 1px, transparent 1px) 0 0/200px 200px,
    linear-gradient(to right, rgba(var(--cy-rgb),.10) 1px, transparent 1px) 0 0/40px 40px,
    linear-gradient(to bottom, rgba(var(--cy-rgb),.10) 1px, transparent 2px, transparent 0 40px),
    radial-gradient(1200px 800px at 50% 50%, #061115 0%, #060c0f 55%, #05070a 100%);
}

.scan{
  z-index:1; pointer-events:none;
  background:repeating-linear-gradient(to bottom, rgba(var(--cy-rgb),.05), rgba(var(--cy-rgb),.05) 2px, transparent 2px 6px);
  mix-blend-mode:screen; animation:scan 6s linear infinite;
}
@keyframes scan{0%{transform:translateY(-20%)}100%{transform:translateY(20%)}}

/* Red veil */
#redveil{
  position:fixed; inset:0; pointer-events:none; z-index:3;
  background:radial-gradient(circle at 50% 50%, rgba(255,0,0,0.0), rgba(255,0,0,0.10));
  opacity:0; transition:opacity 0.9s ease;
}

/* HUD */
.hud{
  position:fixed; inset:0; width:100vw; height:100vh; z-index:2;
  transform:scale(var(--fit)); transform-origin:50% 50%;
}

/* Core */
.core{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:min(58vmin,520px); height:min(58vmin,520px);
  display:grid; place-items:center;
  overflow:visible; contain:layout;
}
.ring{
  position:relative; width:100%; height:100%; border-radius:50%;
  border:2px solid var(--cy);
  box-shadow:inset 0 0 40px rgba(var(--cy-rgb),.35);
  filter:drop-shadow(0 0 12px var(--cy)) drop-shadow(0 0 28px rgba(var(--cy-rgb),.25));
}
.ring:before,.ring:after{
  content:""; position:absolute; inset:7%; border-radius:50%;
  border:2px dashed rgba(var(--cy-rgb),.75);
  filter:drop-shadow(0 0 6px var(--cy));
}
.ring:before{animation:spin 16s linear infinite}
.ring:after{inset:18%; border-style:dotted; animation:spin 8s linear reverse infinite}
.disc{
  position:absolute; width:45%; height:45%; border-radius:50%;
  background:radial-gradient(circle at 50% 50%, rgba(var(--cy-rgb),.85), rgba(var(--cy-rgb),.25) 60%, transparent 70%);
  border:2px solid rgba(var(--cy-rgb),.8); animation:pulse 2.2s ease-in-out infinite;
  filter:drop-shadow(0 0 12px var(--cy)) drop-shadow(0 0 28px rgba(var(--cy-rgb),.25));
}
.label{
  position:absolute; inset:auto 0 14%; text-align:center; letter-spacing:.25em;
  font-weight:900; font-size:1.3em; color:#fff;
  text-shadow:0 0 10px var(--cy), 0 0 20px rgba(var(--cy-rgb),.6);
}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{
  0%,100%{box-shadow:0 0 18px 6px rgba(var(--cy-rgb),.45)}
  50%{box-shadow:0 0 36px 14px rgba(var(--cy-rgb),.75)}
}

/* Widgets */
.widget{
  position:absolute; padding:10px 14px; min-width:clamp(140px,24vmin,240px);
  border:1px solid var(--cy); border-radius:10px;
  background:linear-gradient(180deg, var(--glass), rgba(var(--cy-rgb),.03));
  box-shadow:0 0 18px rgba(var(--cy-rgb),.35), inset 0 0 18px rgba(var(--cy-rgb),.12);
  color:#fff; backdrop-filter:blur(3px);
}
.widget h4{margin:.1rem 0 .35rem; font-size:.9rem; color:#fff; opacity:.9}
.row{display:flex; gap:.5rem; align-items:baseline; flex-wrap:wrap}
.muted{opacity:.7; font-size:.85rem; color:#fff}
.chip{display:inline-block; padding:.2rem .5rem; border:1px solid var(--cy);
  border-radius:999px; background:rgba(var(--cy-rgb),.08); font-size:.8rem; color:#fff}

/* Layout */
.w-time{top:2vh; right:2vw}
.w-net{bottom:2vh; left:2vw}
.w-hello{bottom:2vh; right:2vw}
.w-sys{top:2vh; left:2vw; min-width:220px}
.w-ctrl{top:2vh; right:2vw; min-width:220px}
.w-mic{top:14vh; right:2vw; min-width:220px}

/* Console: capped height + scroll */
.w-log{bottom:14vh; left:2vw; width:min(78vw,360px); overflow:hidden; max-height:28vh}
.log{
  font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
  font-size:.82rem; height:22vh;
  overflow:auto; border-top:1px solid rgba(var(--cy-rgb),.2); padding-top:.4rem; color:#fff
}

/* Battery bar with fallback animation */
.bar{
  width:100%; height:10px; border:1px solid var(--cy);
  border-radius:999px; margin:.45rem 0; overflow:hidden; position:relative;
  background: rgba(var(--cy-rgb), .06);
}
.bar>div{
  height:100%; width:0%; background:var(--cy);
  border-radius:999px; box-shadow:0 0 10px var(--cy);
  transition: width .6s ease;
}
.bar.indeterminate>div{
  width:40%;
  background:linear-gradient(90deg, transparent 0%, var(--cy) 50%, transparent 100%);
  background-size:200% 100%;
  animation:indet 1.1s linear infinite;
  box-shadow:0 0 12px var(--cy);
}
@keyframes indet{ from{ background-position:200% 0 } to{ background-position:-200% 0 } }

/* Radar */
.w-radar{left:50%; transform:translateX(-50%); bottom:2vh}
.radar{position:relative; width:220px; height:220px; border-radius:50%; border:1px solid var(--cy); overflow:hidden;
  background:
    radial-gradient(circle at center, rgba(var(--cy-rgb),.25) 0 1px, transparent 1px) 0 0/18px 18px,
    radial-gradient(circle at center, rgba(var(--cy-rgb),.12) 0 2px, transparent 2px) 0 0/36px 36px,
    radial-gradient(100px 100px at center, rgba(var(--cy-rgb),.08), transparent 70%);
}
.radar .sweep{position:absolute; inset:-10% -10%; background:conic-gradient(from 0deg, rgba(var(--cy-rgb),.45), rgba(var(--cy-rgb),0) 55%); animation:rotate 3.6s linear infinite; filter:blur(2px)}
.radar.paused .sweep{animation-play-state:paused}
@keyframes rotate{to{transform:rotate(360deg)}}
.blip{position:absolute; width:6px; height:6px; border-radius:50%; background:var(--cy);
  left:var(--x); top:var(--y); box-shadow:0 0 10px var(--cy); animation:blink 1.6s ease-in-out infinite}
@keyframes blink{50%{opacity:.2}}

/* Controls FAB — always visible */
.ctrl-fab{
  position:fixed; top:1.2vh; left:1.2vw; z-index:6;
  width:48px; height:48px; border-radius:12px;
  border:1px solid var(--cy); background:rgba(0,0,0,.35); color:#fff;
  display:grid; place-items:center; cursor:pointer;
  box-shadow:0 0 14px rgba(var(--cy-rgb),.45);
  user-select:none;
}

/* Center label glitch effect */
.glitch{position:relative; color:#fff}
.glitch::before,.glitch::after{content:attr(data-text); position:absolute; left:0; right:0; text-align:center; opacity:.8}
.glitch::before{transform:translate(-2px,0); text-shadow:-2px 0 #ff7043; animation:glitch-1 1.8s infinite linear alternate-reverse}
.glitch::after{transform:translate(2px,0); text-shadow:2px 0 #ef5350; animation:glitch-2 2.1s infinite linear alternate-reverse}
@keyframes glitch-1{0%{clip-path:inset(10% 0 70% 0)}20%{clip-path:inset(40% 0 35% 0)}40%{clip-path:inset(20% 0 55% 0)}60%{clip-path:inset(65% 0 10% 0)}80%{clip-path:inset(30% 0 40% 0)}100%{clip-path:inset(5% 0 80% 0)}}
@keyframes glitch-2{0%{clip-path:inset(60% 0 15% 0)}25%{clip-path:inset(25% 0 50% 0)}50%{clip-path:inset(70% 0 5% 0)}75%{clip-path:inset(15% 0 65% 0)}100%{clip-path:inset(50% 0 25% 0)}}

/* Alert theme */
body.alert{--cy:#e53935; --cy-rgb:229,57,53; background:#0a0505}
body.alert #redveil{opacity:1}

/* Screen glitch overlay during morph */
.screen-glitch{
  position:fixed; inset:0; z-index:9999; pointer-events:none;
  background:repeating-linear-gradient(to bottom, rgba(255,255,255,0.10) 0 2px, transparent 2px 4px);
  mix-blend-mode:overlay; animation:glitch-flicker .12s steps(2,end) infinite;
}
@keyframes glitch-flicker{
  0%{clip-path:inset(5% 0 70% 0)}25%{clip-path:inset(40% 0 20% 0)}
  50%{clip-path:inset(10% 0 60% 0)}75%{clip-path:inset(60% 0 10% 0)}
  100%{clip-path:inset(15% 0 40% 0)}
}

.hidden{display:none !important}
